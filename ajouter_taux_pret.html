<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Gestion des Taux de Prêt</title>
    <script src="url.js"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      input,
      button {
        margin: 5px;
        padding: 5px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .interval-group {
        display: flex;
        gap: 10px;
        margin-bottom: 5px;
        align-items: center;
      }
      .interval-group input {
        width: 100px;
      }
      .remove-btn {
        background-color: crimson;
        color: white;
        border: none;
        padding: 3px 8px;
        cursor: pointer;
      }
    </style>
    <link rel="stylesheet" href="assets/css/acceuil.css" />
    <link rel="stylesheet" href="assets/css/ajouter_taux_pret.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
    />
  </head>
  <body>
    <nav class="top-navbar">
      <div class="nav-brand">
        <i class="fas fa-university"></i>
        <span>BankFlow Pro</span>
      </div>
      <div class="nav-actions">
        <div class="user-profile">
          <i class="fas fa-user-circle"></i>
          <span>Admin</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="notification-icon">
          <i class="fas fa-bell"></i>
          <span class="notification-badge">3</span>
        </div>
      </div>
    </nav>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3>Menu Principal</h3>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li class="nav-item active">
            <a href="accueil.html" class="nav-link">
              <i class="fas fa-tachometer-alt"></i>
              <span>Tableau de Bord</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="ajouter_taux_pret.html" class="nav-link">
              <i class="fas fa-percentage"></i>
              <span> Configurer Taux </span>
            </a>
          </li>
          <li class="nav-item">
            <a href="clients.html" class="nav-link">
              <i class="fas fa-users"></i>
              <span>Clients</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="prets.html" class="nav-link">
              <i class="fas fa-money-check-alt"></i>
              <span>Prêts</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="fonds.html" class="nav-link">
              <i class="fas fa-piggy-bank"></i>
              <span>Fonds</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="taux.htm" class="nav-link">
              <i class="fas fa-percentage"></i>
              <span>Taux de Prêt</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="interets_graphique.html" class="nav-link">
              <i class="fas fa-chart-line"></i>
              <span>Interets Gagnés</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="parametres.html" class="nav-link">
              <i class="fas fa-cog"></i>
              <span>Paramètres</span>
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <div class="main-content">
      <div class="content-wrapper">
        <div class="page-header">
          <h1><i class="fas fa-percent"></i> Gestion des Taux de Prêt</h1>
          <p class="subtitle">Configurez et gérez les taux d'intérêt selon les durées de prêt</p>
        </div>

        <div class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label for="type_pret">
                <i class="fas fa-tag"></i> Type de prêt
              </label>
              <input type="text" id="type_pret" placeholder="Type de prêt" required />
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="inf_mois">
                <i class="fas fa-calendar-alt"></i> Durée minimale
              </label>
              <input type="number" id="inf_mois" placeholder="Inf. à (mois)" required />
            </div>
            <div class="form-group">
              <label for="inf_taux">
                <i class="fas fa-percentage"></i> Taux minimum
              </label>
              <input type="number" step="0.01" id="inf_taux" placeholder="Taux %" required />
            </div>

          </div>
          <!-- Section des intervalles -->
          <div class="intervals-section">
            <div class="intervals-header">
              <h3>
                <i class="fas fa-layer-group"></i> Intervalles de Taux
              </h3>
            </div>
            
            <div id="intervals_container">
              <div class="interval-group">
                <input type="number" placeholder="Min (mois)" class="min" required />
                <input type="number" placeholder="Max (mois)" class="max" required />
                <input type="number" step="0.01" placeholder="Taux (%)" class="taux" required />
              </div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="sup_mois">
                <i class="fas fa-calendar-check"></i> Durée maximale
              </label>
              <input type="number" id="sup_mois" placeholder="Sup. à (mois)" required />
            </div>
            <div class="form-group">
              <label for="sup_taux">
                <i class="fas fa-chart-line"></i> Taux maximum
              </label>
              <input type="number" step="0.01" id="sup_taux" placeholder="Taux %" required />
            </div>
          </div>
          <!-- Boutons d'action -->
          <div class="action-buttons">
            <button class="btn btn-success" onclick="ajouterIntervalle()">
              <i class="fas fa-plus"></i> Ajouter Intervalle
            </button>
            <button class="btn btn-primary" onclick="enregistrerTaux()">
              <i class="fas fa-save"></i> Enregistrer
            </button>
          </div>
        </div>
      </div>

      <div id="liste-taux">
        <h3><i class="fas fa-list"></i> Taux Configurés</h3>
      </div>
    </div>

    <script>
      function ajouterIntervalle() {
        const container = document.getElementById("intervals_container");
        const group = document.createElement("div");
        group.classList.add("interval-group");

        group.innerHTML = `
        <input type="number" placeholder="Min (mois)" class="min" required>
        <input type="number" placeholder="Max (mois)" class="max" required>
        <input type="number" step="0.01" placeholder="Taux (%)" class="taux" required>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">×</button>
      `;
        container.appendChild(group);
      }
      function enregistrerTaux() {
        const typePret = document.getElementById("type_pret").value;
        const infMois = document.getElementById("inf_mois").value;
        const infTaux = document.getElementById("inf_taux").value;
        const supMois = document.getElementById("sup_mois").value;
        const supTaux = document.getElementById("sup_taux").value;

        const minInputs = document.querySelectorAll(".min");
        const maxInputs = document.querySelectorAll(".max");
        const tauxInputs = document.querySelectorAll(".taux");

        const formData = new FormData();
        formData.append("type_pret", typePret);
        formData.append("inf_mois", infMois);
        formData.append("inf_taux", infTaux);
        formData.append("sup_mois", supMois);
        formData.append("sup_taux", supTaux);

        for (let i = 0; i < minInputs.length; i++) {
          formData.append("min[]", minInputs[i].value);
          formData.append("max[]", maxInputs[i].value);
          formData.append("taux[]", tauxInputs[i].value);
        }

        fetch(apiBase + "/taux_pret/ajouter", {
          method: "POST",
          body: formData,
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              alert("Taux enregistrés avec succès !");
              resetForm();
              chargerTaux();
            } else {
              alert("Erreur : " + data.message);
            }
          })
          .catch((err) => {
            console.error("Erreur AJAX:", err);
          });
      }
      function resetForm() {
        document.getElementById("type_pret").value = "";
        document.getElementById("inf_mois").value = "";
        document.getElementById("inf_taux").value = "";
        document.getElementById("sup_mois").value = "";
        document.getElementById("sup_taux").value = "";
        document.getElementById("intervals_container").innerHTML = `
        <div class="interval-group">
          <input type="number" placeholder="Min (mois)" class="min" required>
          <input type="number" placeholder="Max (mois)" class="max" required>
          <input type="number" step="0.01" placeholder="Taux (%)" class="taux" required>
        </div>
      `;
      }

      function chargerTaux() {
    fetch(apiBase + "/taux_pret")
      .then((res) => res.json())
      .then((data) => {
        const container = document.getElementById("liste-taux");
        container.innerHTML = '<h3><i class="fas fa-list"></i> Taux Configurés</h3>';

        data.forEach((row) => {
          const div = document.createElement("div");
          div.className = "taux-card";
          div.style.border = "1px solid var(--border-color)";
          div.style.padding = "20px";
          div.style.margin = "15px 0";
          div.style.borderRadius = "12px";
          div.style.backgroundColor = "white";
          div.style.boxShadow = "0 2px 10px var(--shadow-color)";
          div.style.transition = "all 0.3s ease";

          let html = `
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
              <i class="fas fa-percent" style="color: var(--primary-color); font-size: 1.2rem;"></i>
              <h3 style="color: var(--primary-color); margin: 0; font-size: 1.3rem;">${row.type}</h3>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
              <div class="taux-item" style="background: var(--light-color); padding: 15px; border-radius: 8px;">
                <p style="font-weight: 600; color: var(--dark-color); margin-bottom: 5px;">0 à ${row.inf_mois} mois</p>
                <p style="font-size: 1.5rem; color: var(--accent-color); font-weight: 700;">${row.inf_taux}%</p>
              </div>`;

          if (row.intervalles.length > 0) {
            html += `
              <div class="taux-item" style="background: var(--light-color); padding: 15px; border-radius: 8px;">
                <p style="font-weight: 600; color: var(--dark-color); margin-bottom: 5px;">Intervalles</p>
                <div style="max-height: 120px; overflow-y: auto;">`;
            
            row.intervalles.forEach((interval) => {
              html += `<p style="margin: 8px 0; color: var(--dark-color);">${interval}</p>`;
            });
            
            html += `</div></div>`;
          }

          html += `
              <div class="taux-item" style="background: var(--light-color); padding: 15px; border-radius: 8px;">
                <p style="font-weight: 600; color: var(--dark-color); margin-bottom: 5px;">> ${row.sup_mois} mois</p>
                <p style="font-size: 1.5rem; color: var(--accent-color); font-weight: 700;">${row.sup_taux}%</p>
              </div>
            </div>`;

          div.innerHTML = html;
          container.appendChild(div);
          
          // Effet de survol
          div.addEventListener('mouseenter', () => {
            div.style.transform = 'translateY(-5px)';
            div.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.1)';
          });
          
          div.addEventListener('mouseleave', () => {
            div.style.transform = 'none';
            div.style.boxShadow = '0 2px 10px var(--shadow-color)';
          });
        });
      });
}
      chargerTaux();
    </script>
  </body>
</html>
